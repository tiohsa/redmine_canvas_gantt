# Redmine Canvas Gantt Plugin

React、TypeScript、そしてHTML5 Canvas APIで構築された、Redmine向けの高性能ガントチャートプラグインです。

## 主な機能

*   **高いパフォーマンス**: HTML5 Canvasを使用し、大量のチケットデータもスムーズに描画します。
*   **直感的な操作**: ドラッグ＆ドロップによるスケジュールの変更や、依存関係の作成が可能です。
*   **カスタマイズ可能な列**: プロジェクト、トラッカー、ステータス、優先度、作成者、カテゴリ、ターゲットバージョンなど、Redmineの標準フィールドをサイドパネルに自由に表示できます。
*   **高度なソート**: 列ヘッダーをクリックすることで、チケットを並び替えできます。文字列、数値、およびRedmine内部の表示順（ステータスや優先度）に基づいたソートに対応しています。
*   **プロジェクト・バージョンの集約**: プロジェクトやバージョンごとのフィルタリング、階層表示の切り替えなどを1つのメニューに統合しています。フィルタで選択されたプロジェクトは、該当するチケットがない場合でも必ず表示されるようになりました。
*   **スマートなプロジェクト集約**: プロジェクトを跨ぐ親子関係がある場合でも、各チケットを適切なプロジェクトヘッダーの下に配置して表示します。
*   **インライン編集**: 件名、ステータス、優先度、日付、カテゴリ、プロジェクト、工数などをサイドパネルから直接編集できます。権限や親タスクによる制約を考慮した安全なガード機能を備えています。
*   **整理されたサイドバー**: 件名の横に表示されていた不要なプロジェクト・バージョン名を削除し、階層構造による文脈のみに頼ることで画面をすっきりさせました。
*   **データの視認性向上**: ステータスや優先度をカラーバッジで表示。未設定の項目にはハイフン（`-`）を表示し、クリック領域を確保することで編集しやすさを向上させています。
*   **スマートな依存関係**: 直角に折れ曲がるマンハッタンパスを用いて、依存関係を視覚的に分かりやすく描画します。
*   **ズームレベル**: 月・週・日の3段階の表示切り替えに対応しています。
*   **柔軟なUI設定**: 行の高さ（20px〜52px）の調整や、列幅の保存が可能です。
*   **テーマ対応**: Redmineの各種テーマと調和するデザインを採用しています。

## 動作環境

*   **Redmine**: 6.x
*   **Ruby**: 3.x
*   **Node.js**: 18以上（フロントエンドのビルドに必要）
*   **pnpm**:（フロントエンドのパッケージ管理に必要）

## インストール方法

1.  **リポジトリのクローン**
    Redmineの `plugins` ディレクトリへ移動し、リポジトリをクローンします：
    ```bash
    cd /path/to/redmine/plugins
    git clone https://github.com/your-repo/redmine_canvas_gantt.git
    ```

2.  **フロントエンドのビルド**
    フロントエンドはReact SPAとして構築されており、ビルドが必要です：
    ```bash
    cd redmine_canvas_gantt/spa
    pnpm install
    pnpm run build
    ```

3.  **マイグレーションの実行**
    Redmineのプラグインマイグレーションを実行します：
    ```bash
    cd /path/to/redmine
    bundle exec rake redmine:plugins:migrate
    ```

4.  **Redmineの再起動**
    Redmineを稼働させているサーバー（Puma、Passenger等）を再起動してください。

## 使い方

1.  **モジュールの有効化**
    *   各プロジェクトの「設定」 > 「モジュール」を開きます。
    *   **Canvas Gantt** にチェックを入れて保存します。

2.  **権限の設定**
    *   「管理」 > 「ロールと権限」を開きます。
    *   対象のロールに対して「View canvas gantt」および「Edit canvas gantt」の権限を付与します。

3.  **チャートの表示**
    *   プロジェクトメニューの「Canvas Gantt」タブをクリックします。
    *   マウスホイール（Ctrl/Cmd押下）やツールバーのボタンでズームできます。
    *   チケットの端をドラッグすると期間を変更、中央をドラッグすると移動できます。
    *   チケットの末端にあるドットを他のチケットへドラッグすると、依存関係を作成できます。

## 開発について

フロントエンドのソースコードは `plugins/redmine_canvas_gantt/spa` にあります。

### セットアップ

```bash
cd plugins/redmine_canvas_gantt/spa
pnpm install
```

### 開発用サーバーの起動

```bash
pnpm run dev
```

**注意**: スタンドアロンモードで動作させるには、`main.tsx` 等で `window.RedmineCanvasGantt` をモックし、APIエンドポイントやトークンを供給する必要があります。

## ライセンス

MIT License
Copyright (c) 2024 tiohsa
